<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script>if(location.protocol !== 'https:' && location.hostname !== 'localhost'){location.replace('https:' + location.href.substring(location.protocol.length));}</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="theme-color" content="#1f4e79">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BSN9B">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <title>RN Resources - BSN9B</title>
    <script>
        if (localStorage.getItem('bsn9b_auth') !== 'true') {
            window.location.href = '/';
        }
    </script>
    <style>
        /* CSS Variables for theming */
        :root {
            --bg-page: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-input: #fafafa;
            --text-primary: #1a1a2e;
            --text-secondary: #666666;
            --accent: #1f4e79;
            --border: #e2e8f0;
            --chat-msg-other-bg: #e2e8f0;
        }
        [data-theme="dark"] {
            --bg-page: linear-gradient(135deg, #0a0a14 0%, #0d1117 50%, #161b22 100%);
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-input: #16213e;
            --text-primary: #e6e6e6;
            --text-secondary: #aaaaaa;
            --accent: #4a90d9;
            --border: #2d3748;
            --chat-msg-other-bg: #2d3748;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-page);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #1f4e79 0%, #2d5a87 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 16px 16px 0 0;
            text-align: center;
        }
        .header h1 { font-size: 26px; margin-bottom: 5px; }
        .header p { opacity: 0.9; font-size: 13px; }
        .back-btn {
            display: inline-block;
            margin-top: 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            transition: background 0.2s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.3); }
        .content {
            background: white;
            padding: 30px;
            border-radius: 0 0 16px 16px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }
        .card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
        }
        .card h2 {
            color: #1f4e79;
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1f4e79;
        }
        .card h3 {
            color: #334155;
            font-size: 14px;
            margin: 15px 0 8px 0;
        }
        .search-box {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        .search-box input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        .search-box button, .btn {
            padding: 10px 16px;
            background: #1f4e79;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: background 0.2s;
        }
        .search-box button:hover, .btn:hover { background: #2d5a87; }
        .btn-secondary {
            background: #64748b;
        }
        .btn-secondary:hover { background: #475569; }
        .link-list {
            list-style: none;
        }
        .link-list li {
            margin-bottom: 8px;
        }
        .link-list a {
            color: #1f4e79;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .link-list a:hover { text-decoration: underline; }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 10px;
        }
        th, td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background: #1f4e79;
            color: white;
            font-weight: 600;
        }
        tr:hover { background: #f1f5f9; }
        .abbrev-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
            font-size: 12px;
        }
        .abbrev-item {
            padding: 4px 8px;
            background: #e8f4fc;
            border-radius: 4px;
        }
        .abbrev-item strong { color: #1f4e79; }
        .calc-result {
            margin-top: 10px;
            padding: 12px;
            background: #e8f4fc;
            border-radius: 8px;
            font-weight: 600;
            color: #1f4e79;
            display: none;
        }
        /* Smart Drug Autocomplete */
        .drug-search-wrapper {
            position: relative;
            margin-bottom: 10px;
        }
        .drug-search-wrapper input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        .drug-search-wrapper input:focus {
            border-color: #1f4e79;
            box-shadow: 0 0 0 3px rgba(31, 78, 121, 0.15);
            outline: none;
        }
        .drug-autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 250px;
            overflow-y: auto;
            background: white;
            border: 2px solid #1f4e79;
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
        }
        .drug-autocomplete.show { display: block; }
        .drug-autocomplete-item {
            padding: 10px 14px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            transition: background 0.15s;
        }
        .drug-autocomplete-item:hover { background: #e3f2fd; }
        .drug-autocomplete-item:last-child { border-bottom: none; }
        .drug-autocomplete-item .drug-type {
            font-size: 10px;
            color: #666;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 8px;
        }
        .drug-autocomplete-loading {
            padding: 12px 14px;
            color: #666;
            font-style: italic;
            font-size: 12px;
        }
        .drug-autocomplete-hint {
            padding: 8px 14px;
            background: #fffbeb;
            color: #92400e;
            font-size: 11px;
            border-bottom: 1px solid #fcd34d;
        }
        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
        }
        .input-group label {
            min-width: 100px;
            font-size: 13px;
        }
        .input-group input {
            width: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .input-group span {
            font-size: 12px;
            color: #666;
        }
        footer {
            text-align: center;
            padding: 20px;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
        }
        .nanda-list {
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .nanda-category {
            font-weight: 600;
            color: #1f4e79;
            margin-top: 10px;
            margin-bottom: 5px;
        }
        .nanda-item {
            padding: 4px 8px;
            margin: 2px 0;
            background: #f1f5f9;
            border-radius: 4px;
        }
        .collapsible {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .collapsible:after {
            content: '‚ñº';
            font-size: 10px;
        }
        .collapsible.collapsed:after {
            content: '‚ñ∂';
        }
        .collapse-content {
            display: block;
        }
        .collapse-content.hidden {
            display: none;
        }
        @keyframes alertFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        }
        body.has-alert { padding-top: 50px; }
        body.has-fyi { padding-top: 50px; }
        body.has-alert.has-fyi { padding-top: 100px; }

        /* Bottom Toolbar */
        .bottom-toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .toolbar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 10px;
            transition: color 0.2s;
            background: none;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }

        .toolbar-item:hover { color: var(--accent); }
        .toolbar-item.active { color: var(--accent); }
        .toolbar-item .icon { font-size: 24px; margin-bottom: 2px; }
        .toolbar-item .label { font-weight: 600; }

        /* More Menu */
        .more-menu {
            position: fixed;
            bottom: 70px;
            right: 10px;
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            padding: 8px 0;
            display: none;
            z-index: 1001;
            min-width: 160px;
            border: 1px solid var(--border);
        }

        .more-menu.show { display: block; }

        .more-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 14px;
            transition: background 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            font-family: inherit;
        }

        .more-menu-item:hover { background: var(--bg-secondary); }
        .more-menu-item .menu-icon { font-size: 18px; }

        /* Dark mode support */
        [data-theme="dark"] .content { background: var(--bg-primary); color: var(--text-primary); }
        [data-theme="dark"] .card { background: var(--bg-secondary); border-color: var(--border); }
        [data-theme="dark"] .card h2 { color: var(--accent); border-color: var(--accent); }
        [data-theme="dark"] .link-list a { color: var(--accent); }
        [data-theme="dark"] table { color: var(--text-primary); }
        [data-theme="dark"] th { background: var(--bg-secondary); color: var(--text-primary); }
        [data-theme="dark"] td { border-color: var(--border); }
        [data-theme="dark"] input, [data-theme="dark"] select, [data-theme="dark"] textarea { background: var(--bg-input); color: var(--text-primary); border-color: var(--border); }
        [data-theme="dark"] footer { color: rgba(255,255,255,0.6); }

        /* Lock screen */
        #lockScreenOverlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); z-index: 99999; align-items: center; justify-content: center; flex-direction: column; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .modal-overlay.hidden { display: none; }
        .modal-content { background: var(--bg-primary); border-radius: 16px; padding: 25px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); color: var(--text-primary); }
        .modal-content input, .modal-content select, .modal-content textarea { width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 14px; margin-bottom: 15px; background: var(--bg-input); color: var(--text-primary); }
        .modal-content textarea { min-height: 120px; resize: vertical; }
    </style>
</head>
<body>
    <!-- Alert/FYI Banners -->
    <div id="alertBanner" style="display: none; position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 12px 20px; text-align: center; font-weight: 600; font-size: 14px; z-index: 10000; box-shadow: 0 4px 15px rgba(220, 38, 38, 0.5); animation: alertFlash 1s infinite;">
        <span id="alertText"></span>
        <span style="position: absolute; right: 15px; font-size: 11px; opacity: 0.8;">‚ö†Ô∏è ALERT</span>
    </div>
    <div id="fyiBanner" style="display: none; position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #1a1a2e; padding: 12px 20px; text-align: center; font-weight: 600; font-size: 14px; z-index: 9999; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);">
        <span id="fyiText"></span>
        <span style="position: absolute; right: 15px; font-size: 11px; opacity: 0.7;">‚ÑπÔ∏è FYI</span>
    </div>

    <div class="container">
        <div class="header" style="position: relative;">
            <div style="position: absolute; top: 15px; right: 20px;">
                <span id="userDisplay" style="color: rgba(255,255,255,0.8); font-size: 12px; margin-right: 10px;"></span>
                <button onclick="logout()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); padding: 8px 16px; border-radius: 20px; font-size: 12px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">Logout</button>
            </div>
            <h1>RN Resources</h1>
            <p>Drug Information | Lab Values | Calculations | References</p>
            <a href="/home/" class="back-btn">‚Üê Back to Home</a>
        </div>

        <div class="content">
            <!-- Educational Disclaimer Banner -->
            <div style="background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                <p style="font-weight: 700; font-size: 14px; margin-bottom: 5px;">‚ö†Ô∏è EDUCATIONAL USE ONLY - NOT FOR CLINICAL DECISIONS</p>
                <p style="font-size: 12px; opacity: 0.95;">This tool is for nursing student learning purposes only. Always consult your facility's official drug guide, pharmacist, and clinical resources before administering any medication. This tool may contain incomplete or inaccurate information.</p>
            </div>

            <div class="grid">
                <!-- Drug Information -->
                <div class="card">
                    <h2>üíä Drug Information</h2>
                    <p style="font-size: 12px; color: #c62828; background: #ffebee; padding: 8px; border-radius: 6px; margin-bottom: 12px;"><strong>Educational reference only.</strong> Verify all information with official sources.</p>
                    <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Start typing to search medications (smart spelling correction)</p>
                    <div class="drug-search-wrapper">
                        <input type="text" id="drugSearch" placeholder="Type drug name (e.g., met, lisi, ator)..." autocomplete="off">
                        <div id="drugSearchDropdown" class="drug-autocomplete"></div>
                    </div>
                    <div id="drugInfo" style="display:none; padding: 12px; background: #e8f4fc; border-radius: 8px; margin-bottom: 15px;">
                        <h4 id="drugInfoName" style="color: #1f4e79; margin-bottom: 8px;"></h4>
                        <div id="drugInfoDetails" style="font-size: 13px;"></div>
                        <div style="margin-top: 10px; font-size: 12px;">
                            <a id="drugLinkDailyMed" href="#" target="_blank" style="color: #1f4e79; margin-right: 10px;">üìÑ Full Label (DailyMed)</a>
                            <a id="drugLinkDrugs" href="#" target="_blank" style="color: #1f4e79;">üíä Drugs.com</a>
                        </div>
                    </div>
                    <p style="font-size: 11px; color: #888; margin-top: 10px;">Recommended Resources:</p>
                    <ul class="link-list" style="margin-top: 5px;">
                        <li><a href="https://www.nursingcenter.com/drug-information" target="_blank">üìö Lippincott Drug Information</a></li>
                        <li><a href="https://www.nursingcenter.com/clinical-resources" target="_blank">üìö Lippincott Clinical Resources</a></li>
                        <li><a href="https://medlineplus.gov/druginformation.html" target="_blank">üîó MedlinePlus Drugs (NIH)</a></li>
                    </ul>
                </div>

                <!-- Lab Values -->
                <div class="card">
                    <h2>üî¨ Lab Values Reference</h2>
                    <h3 class="collapsible" onclick="toggleCollapse(this)">Complete Blood Count (CBC)</h3>
                    <div class="collapse-content">
                        <table>
                            <tr><th>Test</th><th>Normal Range</th></tr>
                            <tr><td>WBC</td><td>4,500-11,000/mcL</td></tr>
                            <tr><td>RBC (M)</td><td>4.5-5.5 million/mcL</td></tr>
                            <tr><td>RBC (F)</td><td>4.0-5.0 million/mcL</td></tr>
                            <tr><td>Hemoglobin (M)</td><td>14-18 g/dL</td></tr>
                            <tr><td>Hemoglobin (F)</td><td>12-16 g/dL</td></tr>
                            <tr><td>Hematocrit (M)</td><td>40-54%</td></tr>
                            <tr><td>Hematocrit (F)</td><td>36-48%</td></tr>
                            <tr><td>Platelets</td><td>150,000-400,000/mcL</td></tr>
                        </table>
                    </div>
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">Basic Metabolic Panel (BMP)</h3>
                    <div class="collapse-content hidden">
                        <table>
                            <tr><th>Test</th><th>Normal Range</th></tr>
                            <tr><td>Sodium (Na)</td><td>136-145 mEq/L</td></tr>
                            <tr><td>Potassium (K)</td><td>3.5-5.0 mEq/L</td></tr>
                            <tr><td>Chloride (Cl)</td><td>98-106 mEq/L</td></tr>
                            <tr><td>CO2</td><td>23-29 mEq/L</td></tr>
                            <tr><td>BUN</td><td>7-20 mg/dL</td></tr>
                            <tr><td>Creatinine</td><td>0.6-1.2 mg/dL</td></tr>
                            <tr><td>Glucose</td><td>70-100 mg/dL (fasting)</td></tr>
                            <tr><td>Calcium</td><td>8.5-10.5 mg/dL</td></tr>
                        </table>
                    </div>
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">Coagulation</h3>
                    <div class="collapse-content hidden">
                        <table>
                            <tr><th>Test</th><th>Normal Range</th></tr>
                            <tr><td>PT</td><td>11-13.5 seconds</td></tr>
                            <tr><td>INR</td><td>0.8-1.1 (2-3 on warfarin)</td></tr>
                            <tr><td>PTT</td><td>25-35 seconds</td></tr>
                            <tr><td>aPTT</td><td>30-40 seconds</td></tr>
                        </table>
                    </div>
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">Cardiac Markers</h3>
                    <div class="collapse-content hidden">
                        <table>
                            <tr><th>Test</th><th>Normal Range</th></tr>
                            <tr><td>Troponin I</td><td>&lt;0.04 ng/mL</td></tr>
                            <tr><td>Troponin T</td><td>&lt;0.1 ng/mL</td></tr>
                            <tr><td>BNP</td><td>&lt;100 pg/mL</td></tr>
                            <tr><td>CK-MB</td><td>&lt;5 ng/mL</td></tr>
                        </table>
                    </div>
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">ABGs</h3>
                    <div class="collapse-content hidden">
                        <table>
                            <tr><th>Test</th><th>Normal Range</th></tr>
                            <tr><td>pH</td><td>7.35-7.45</td></tr>
                            <tr><td>PaCO2</td><td>35-45 mmHg</td></tr>
                            <tr><td>PaO2</td><td>80-100 mmHg</td></tr>
                            <tr><td>HCO3</td><td>22-26 mEq/L</td></tr>
                            <tr><td>O2 Sat</td><td>95-100%</td></tr>
                        </table>
                    </div>
                </div>

                <!-- Vital Signs -->
                <div class="card">
                    <h2>‚ù§Ô∏è Vital Signs Normal Ranges</h2>
                    <table>
                        <tr><th>Vital Sign</th><th>Adult Normal</th></tr>
                        <tr><td>Heart Rate</td><td>60-100 bpm</td></tr>
                        <tr><td>Blood Pressure</td><td>&lt;120/80 mmHg</td></tr>
                        <tr><td>Respiratory Rate</td><td>12-20 breaths/min</td></tr>
                        <tr><td>Temperature</td><td>97.8-99.1¬∞F (36.5-37.3¬∞C)</td></tr>
                        <tr><td>O2 Saturation</td><td>95-100%</td></tr>
                    </table>
                    <h3>Blood Pressure Categories</h3>
                    <table>
                        <tr><th>Category</th><th>Systolic</th><th>Diastolic</th></tr>
                        <tr><td>Normal</td><td>&lt;120</td><td>&lt;80</td></tr>
                        <tr><td>Elevated</td><td>120-129</td><td>&lt;80</td></tr>
                        <tr><td>HTN Stage 1</td><td>130-139</td><td>80-89</td></tr>
                        <tr><td>HTN Stage 2</td><td>‚â•140</td><td>‚â•90</td></tr>
                        <tr><td>Crisis</td><td>&gt;180</td><td>&gt;120</td></tr>
                    </table>
                </div>

                <!-- IV Calculations -->
                <div class="card">
                    <h2>üíâ IV Drip Rate Calculator</h2>
                    <p style="font-size: 11px; color: #c62828; background: #ffebee; padding: 6px 8px; border-radius: 4px; margin-bottom: 10px;"><strong>Double-check all calculations.</strong> Verify with preceptor/RN before administration.</p>
                    <p style="font-size: 12px; color: #666; margin-bottom: 12px;">For gravity drip or pump rate calculation</p>
                    <div class="input-group">
                        <label>Volume to Infuse:</label>
                        <input type="number" id="ivVolume" placeholder="1000" step="any" min="0">
                        <span>mL</span>
                    </div>
                    <div class="input-group">
                        <label>Infusion Time:</label>
                        <input type="number" id="ivTime" placeholder="8" step="any" min="0">
                        <span>hours</span>
                    </div>
                    <div class="input-group">
                        <label>Drop Factor:</label>
                        <select id="ivDropFactor" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                            <option value="10">10 gtt/mL (Macrodrip)</option>
                            <option value="15" selected>15 gtt/mL (Macrodrip)</option>
                            <option value="20">20 gtt/mL (Macrodrip)</option>
                            <option value="60">60 gtt/mL (Microdrip/Peds)</option>
                        </select>
                    </div>
                    <button onclick="calculateDripRate()" style="width: 100%;">Calculate Drip Rate</button>
                    <div id="dripResult" class="calc-result"></div>

                    <h3 style="margin-top: 20px;">Quick Reference</h3>
                    <table>
                        <tr><th>Set Type</th><th>Drop Factor</th><th>Common Use</th></tr>
                        <tr><td>Macrodrip</td><td>10-20 gtt/mL</td><td>Adults, large volumes</td></tr>
                        <tr><td>Microdrip</td><td>60 gtt/mL</td><td>Peds, precise dosing</td></tr>
                        <tr><td>Blood tubing</td><td>10 gtt/mL</td><td>Blood products</td></tr>
                    </table>
                    <p style="font-size: 11px; color: #666; margin-top: 10px;"><strong>Tip:</strong> For IV pumps, you only need mL/hr (no drop factor needed). Microdrip: gtt/min = mL/hr</p>
                </div>

                <!-- Dosage Calculator -->
                <div class="card">
                    <h2>üíä Dosage Calculator</h2>
                    <p style="font-size: 11px; color: #c62828; background: #ffebee; padding: 6px 8px; border-radius: 4px; margin-bottom: 10px;"><strong>Double-check all calculations.</strong> Verify with preceptor/RN before administration.</p>
                    <p style="font-size: 12px; color: #666; margin-bottom: 12px;">D/H √ó Q (Desired √∑ Have √ó Quantity)</p>
                    <div class="input-group">
                        <label>Desired Dose:</label>
                        <input type="number" id="desiredDose" placeholder="500" step="any" min="0">
                        <span>mg</span>
                    </div>
                    <div class="input-group">
                        <label>Have on Hand:</label>
                        <input type="number" id="haveOnHand" placeholder="250" step="any" min="0">
                        <span>mg per unit</span>
                    </div>
                    <div class="input-group">
                        <label>Quantity per Unit:</label>
                        <input type="number" id="quantity" placeholder="1" value="1" step="any" min="0">
                        <select id="quantityUnit" style="width: 80px; padding: 5px; border-radius: 4px;">
                            <option value="tablet">tablet</option>
                            <option value="mL">mL</option>
                            <option value="capsule">capsule</option>
                        </select>
                    </div>
                    <button onclick="calculateDosage()" style="width: 100%;">Calculate</button>
                    <div id="dosageResult" class="calc-result"></div>

                    <h3 style="margin-top: 20px;">Weight-Based Dosing</h3>
                    <p style="font-size: 11px; color: #666; margin-bottom: 8px;">Calculate dose based on patient weight</p>
                    <div class="input-group">
                        <label>Order (mg/kg):</label>
                        <input type="number" id="mgPerKg" placeholder="10" step="any" min="0">
                        <span>mg/kg</span>
                    </div>
                    <div class="input-group">
                        <label>Patient Weight:</label>
                        <input type="number" id="patientWeight" placeholder="70" step="any" min="0">
                        <select id="weightUnit" style="width: 60px; padding: 5px; border-radius: 4px;">
                            <option value="kg">kg</option>
                            <option value="lb">lb</option>
                        </select>
                    </div>
                    <button onclick="calculateWeightDose()" style="width: 100%;">Calculate Weight-Based Dose</button>
                    <div id="weightDoseResult" class="calc-result"></div>
                </div>

                <!-- Common Abbreviations -->
                <div class="card">
                    <h2>üìù Common Abbreviations</h2>
                    <div class="abbrev-grid">
                        <div class="abbrev-item"><strong>AC</strong> - Before meals</div>
                        <div class="abbrev-item"><strong>PC</strong> - After meals</div>
                        <div class="abbrev-item"><strong>BID</strong> - Twice daily</div>
                        <div class="abbrev-item"><strong>TID</strong> - Three times daily</div>
                        <div class="abbrev-item"><strong>QID</strong> - Four times daily</div>
                        <div class="abbrev-item"><strong>PRN</strong> - As needed</div>
                        <div class="abbrev-item"><strong>STAT</strong> - Immediately</div>
                        <div class="abbrev-item"><strong>PO</strong> - By mouth</div>
                        <div class="abbrev-item"><strong>IV</strong> - Intravenous</div>
                        <div class="abbrev-item"><strong>IM</strong> - Intramuscular</div>
                        <div class="abbrev-item"><strong>SQ/SubQ</strong> - Subcutaneous</div>
                        <div class="abbrev-item"><strong>SL</strong> - Sublingual</div>
                        <div class="abbrev-item"><strong>NPO</strong> - Nothing by mouth</div>
                        <div class="abbrev-item"><strong>WNL</strong> - Within normal limits</div>
                        <div class="abbrev-item"><strong>SOB</strong> - Shortness of breath</div>
                        <div class="abbrev-item"><strong>ROM</strong> - Range of motion</div>
                        <div class="abbrev-item"><strong>ADL</strong> - Activities of daily living</div>
                        <div class="abbrev-item"><strong>I&O</strong> - Intake and output</div>
                        <div class="abbrev-item"><strong>BRP</strong> - Bathroom privileges</div>
                        <div class="abbrev-item"><strong>OOB</strong> - Out of bed</div>
                        <div class="abbrev-item"><strong>HS</strong> - At bedtime</div>
                        <div class="abbrev-item"><strong>QHS</strong> - Every bedtime</div>
                        <div class="abbrev-item"><strong>GT</strong> - Gastrostomy tube</div>
                        <div class="abbrev-item"><strong>NG</strong> - Nasogastric</div>
                    </div>
                </div>

                <!-- Clinical Toolkit -->
                <div class="card" style="grid-column: span 2;">
                    <h2>ü©∫ Clinical Toolkit</h2>
                    <p style="font-size: 12px; color: #666; margin-bottom: 15px;">Quick reference tools for clinical rotations</p>

                    <!-- Pediatric Vital Signs -->
                    <h3 class="collapsible" onclick="toggleCollapse(this)">üë∂ Pediatric Vital Signs</h3>
                    <div class="collapse-content">
                        <table>
                            <tr><th>Age</th><th>HR (bpm)</th><th>RR (/min)</th><th>BP (mmHg)</th></tr>
                            <tr><td>Newborn</td><td>100-160</td><td>30-60</td><td>60-90/30-60</td></tr>
                            <tr><td>Infant (1-12 mo)</td><td>80-140</td><td>25-40</td><td>80-100/50-70</td></tr>
                            <tr><td>Toddler (1-3 yr)</td><td>80-130</td><td>20-30</td><td>90-105/55-70</td></tr>
                            <tr><td>Preschool (3-5 yr)</td><td>80-120</td><td>20-25</td><td>95-110/60-75</td></tr>
                            <tr><td>School Age (6-12 yr)</td><td>70-110</td><td>18-22</td><td>100-120/60-75</td></tr>
                            <tr><td>Adolescent (13+ yr)</td><td>60-100</td><td>12-20</td><td>110-135/65-85</td></tr>
                        </table>
                    </div>

                    <!-- Pain Scales -->
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">üò£ Pain Assessment Scales</h3>
                    <div class="collapse-content hidden">
                        <div style="margin-bottom: 15px;">
                            <strong>Numeric Rating Scale (NRS)</strong>
                            <p style="font-size: 12px; margin-top: 5px;">0 = No pain | 1-3 = Mild | 4-6 = Moderate | 7-10 = Severe</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>FLACC Scale (Non-verbal/Pediatric)</strong>
                            <table style="font-size: 11px;">
                                <tr><th>Category</th><th>0</th><th>1</th><th>2</th></tr>
                                <tr><td><strong>F</strong>ace</td><td>Relaxed</td><td>Occasional grimace</td><td>Frequent grimace</td></tr>
                                <tr><td><strong>L</strong>egs</td><td>Relaxed</td><td>Restless</td><td>Kicking</td></tr>
                                <tr><td><strong>A</strong>ctivity</td><td>Lying quietly</td><td>Squirming</td><td>Arched, rigid</td></tr>
                                <tr><td><strong>C</strong>ry</td><td>No cry</td><td>Moans, whimpers</td><td>Crying steadily</td></tr>
                                <tr><td><strong>C</strong>onsolability</td><td>Content</td><td>Reassured by touch</td><td>Difficult to console</td></tr>
                            </table>
                            <p style="font-size: 11px; color: #666; margin-top: 5px;">Score 0-10: 0 = No pain, 1-3 = Mild, 4-6 = Moderate, 7-10 = Severe</p>
                        </div>
                    </div>

                    <!-- Glasgow Coma Scale -->
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">üß† Glasgow Coma Scale (GCS)</h3>
                    <div class="collapse-content hidden">
                        <table style="font-size: 12px;">
                            <tr><th>Response</th><th>Score</th><th>Description</th></tr>
                            <tr><td rowspan="4"><strong>Eye Opening</strong></td><td>4</td><td>Spontaneous</td></tr>
                            <tr><td>3</td><td>To voice</td></tr>
                            <tr><td>2</td><td>To pain</td></tr>
                            <tr><td>1</td><td>None</td></tr>
                            <tr><td rowspan="5"><strong>Verbal</strong></td><td>5</td><td>Oriented</td></tr>
                            <tr><td>4</td><td>Confused</td></tr>
                            <tr><td>3</td><td>Inappropriate words</td></tr>
                            <tr><td>2</td><td>Incomprehensible sounds</td></tr>
                            <tr><td>1</td><td>None</td></tr>
                            <tr><td rowspan="6"><strong>Motor</strong></td><td>6</td><td>Obeys commands</td></tr>
                            <tr><td>5</td><td>Localizes pain</td></tr>
                            <tr><td>4</td><td>Withdraws from pain</td></tr>
                            <tr><td>3</td><td>Abnormal flexion (decorticate)</td></tr>
                            <tr><td>2</td><td>Extension (decerebrate)</td></tr>
                            <tr><td>1</td><td>None</td></tr>
                        </table>
                        <p style="font-size: 11px; margin-top: 10px;"><strong>Interpretation:</strong> 15 = Normal | 13-14 = Mild | 9-12 = Moderate | 3-8 = Severe</p>
                    </div>

                    <!-- APGAR Calculator -->
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">üë∂ APGAR Score Calculator</h3>
                    <div class="collapse-content hidden">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px;">
                            <div>
                                <label style="font-size: 12px; font-weight: 600;">Appearance (Color)</label>
                                <select id="apgar-appearance" onchange="calculateAPGAR()" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="0">Blue/Pale all over</option>
                                    <option value="1">Body pink, extremities blue</option>
                                    <option value="2">Completely pink</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 12px; font-weight: 600;">Pulse (Heart Rate)</label>
                                <select id="apgar-pulse" onchange="calculateAPGAR()" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="0">Absent</option>
                                    <option value="1">< 100 bpm</option>
                                    <option value="2">> 100 bpm</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 12px; font-weight: 600;">Grimace (Reflex)</label>
                                <select id="apgar-grimace" onchange="calculateAPGAR()" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="0">No response</option>
                                    <option value="1">Grimace</option>
                                    <option value="2">Cry, cough, sneeze</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 12px; font-weight: 600;">Activity (Muscle Tone)</label>
                                <select id="apgar-activity" onchange="calculateAPGAR()" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="0">Limp</option>
                                    <option value="1">Some flexion</option>
                                    <option value="2">Active movement</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 12px; font-weight: 600;">Respiration</label>
                                <select id="apgar-respiration" onchange="calculateAPGAR()" style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="0">Absent</option>
                                    <option value="1">Slow, irregular</option>
                                    <option value="2">Good, crying</option>
                                </select>
                            </div>
                        </div>
                        <div id="apgar-result" class="calc-result" style="display: block; background: #e8f4fc; padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <strong>APGAR Score:</strong> <span id="apgar-score">0</span>/10
                            <span id="apgar-interpretation" style="margin-left: 10px; font-size: 12px;"></span>
                        </div>
                    </div>

                    <!-- SBAR Template -->
                    <h3 class="collapsible collapsed" onclick="toggleCollapse(this)">üìã SBAR Communication Template</h3>
                    <div class="collapse-content hidden">
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; font-size: 12px;">
                            <div style="margin-bottom: 12px;">
                                <strong style="color: #1f4e79;">S - Situation</strong>
                                <p style="margin-top: 4px;">"I am calling about [patient name] in [room/unit]. The problem I am calling about is..."</p>
                            </div>
                            <div style="margin-bottom: 12px;">
                                <strong style="color: #1f4e79;">B - Background</strong>
                                <p style="margin-top: 4px;">"The patient's diagnosis is... They were admitted on [date] for... Relevant history includes..."</p>
                            </div>
                            <div style="margin-bottom: 12px;">
                                <strong style="color: #1f4e79;">A - Assessment</strong>
                                <p style="margin-top: 4px;">"My assessment is that... Vital signs are... Changes from baseline include..."</p>
                            </div>
                            <div>
                                <strong style="color: #1f4e79;">R - Recommendation</strong>
                                <p style="margin-top: 4px;">"I recommend... Would you like me to... Is there anything else you need?"</p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- NANDA Diagnoses Quick Reference -->
                <div class="card">
                    <h2>ü©∫ NANDA Nursing Diagnoses</h2>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Common nursing diagnoses by category</p>
                    <div class="nanda-list">
                        <div class="nanda-category">Activity/Rest</div>
                        <div class="nanda-item">Activity intolerance</div>
                        <div class="nanda-item">Fatigue</div>
                        <div class="nanda-item">Insomnia</div>
                        <div class="nanda-item">Impaired physical mobility</div>

                        <div class="nanda-category">Circulation</div>
                        <div class="nanda-item">Decreased cardiac output</div>
                        <div class="nanda-item">Ineffective tissue perfusion</div>
                        <div class="nanda-item">Risk for bleeding</div>

                        <div class="nanda-category">Respiration</div>
                        <div class="nanda-item">Ineffective airway clearance</div>
                        <div class="nanda-item">Impaired gas exchange</div>
                        <div class="nanda-item">Ineffective breathing pattern</div>

                        <div class="nanda-category">Safety</div>
                        <div class="nanda-item">Risk for falls</div>
                        <div class="nanda-item">Risk for infection</div>
                        <div class="nanda-item">Impaired skin integrity</div>

                        <div class="nanda-category">Pain/Comfort</div>
                        <div class="nanda-item">Acute pain</div>
                        <div class="nanda-item">Chronic pain</div>
                        <div class="nanda-item">Nausea</div>

                        <div class="nanda-category">Elimination</div>
                        <div class="nanda-item">Constipation</div>
                        <div class="nanda-item">Diarrhea</div>
                        <div class="nanda-item">Impaired urinary elimination</div>
                    </div>
                    <a href="/app/" class="btn" style="display: block; text-align: center; margin-top: 15px;">Full NANDA Database ‚Üí</a>
                </div>

                <!-- Additional Resources -->
                <div class="card">
                    <h2>üîó Additional Resources</h2>
                    <ul class="link-list">
                        <li><a href="https://www.nursingworld.org/" target="_blank">üè• American Nurses Association</a></li>
                        <li><a href="https://www.ncsbn.org/nclex.htm" target="_blank">üìö NCLEX Resources (NCSBN)</a></li>
                        <li><a href="https://www.cdc.gov/niosh/topics/bbp/" target="_blank">üß§ CDC Bloodborne Pathogens</a></li>
                        <li><a href="https://www.jointcommission.org/resources/patient-safety-topics/patient-safety/" target="_blank">‚öïÔ∏è Joint Commission Patient Safety</a></li>
                        <li><a href="https://www.ahrq.gov/patient-safety/index.html" target="_blank">üõ°Ô∏è AHRQ Patient Safety</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Lock Screen Overlay -->
    <div id="lockScreenOverlay">
        <div style="text-align: center; color: white;">
            <div style="font-size: 80px; margin-bottom: 20px;">üîí</div>
            <h1 style="font-size: 42px; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">BSN9B</h1>
            <p style="font-size: 18px; opacity: 0.8; margin-bottom: 40px;">Portal Locked</p>
            <button onclick="unlockScreen()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; border: none; padding: 18px 50px; border-radius: 30px; font-size: 18px; font-weight: 600; cursor: pointer; box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);">üîì Unlock Portal</button>
            <p style="margin-top: 30px; font-size: 12px; opacity: 0.5;">Click unlock to return to your session</p>
        </div>
    </div>

    <!-- Bottom Toolbar -->
    <nav class="bottom-toolbar">
        <a href="/home/" class="toolbar-item">
            <span class="icon">üè†</span>
            <span class="label">Home</span>
        </a>
        <a href="/app/" class="toolbar-item">
            <span class="icon">üìù</span>
            <span class="label">RN Notes</span>
        </a>
        <a href="/community/" class="toolbar-item">
            <span class="icon">üë•</span>
            <span class="label">Community</span>
        </a>
        <a href="/resources/" class="toolbar-item active">
            <span class="icon">üìö</span>
            <span class="label">Resources</span>
        </a>
        <button class="toolbar-item" onclick="toggleMoreMenu()">
            <span class="icon">‚ãØ</span>
            <span class="label">More</span>
        </button>
    </nav>

    <!-- More Menu -->
    <div id="moreMenu" class="more-menu">
        <button class="more-menu-item" onclick="toggleDarkMode(); toggleMoreMenu();">
            <span class="menu-icon" id="themeMenuIcon">üåô</span>
            <span id="themeMenuText">Dark Mode</span>
        </button>
        <button class="more-menu-item" onclick="lockScreen(); toggleMoreMenu();">
            <span class="menu-icon">üîí</span>
            <span>Lock Screen</span>
        </button>
        <button class="more-menu-item" onclick="document.getElementById('feedbackModal').classList.remove('hidden'); toggleMoreMenu();">
            <span class="menu-icon">üí°</span>
            <span>Feedback</span>
        </button>
        <button class="more-menu-item" onclick="logout();">
            <span class="menu-icon">üö™</span>
            <span>Logout</span>
        </button>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 20px;">üí° Send Feedback</h2>
                <button onclick="document.getElementById('feedbackModal').classList.add('hidden')" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary);">&times;</button>
            </div>
            <form action="https://formsubmit.co/christiankholden@gmail.com" method="POST">
                <input type="hidden" name="_subject" value="BSN9B Feedback">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_template" value="table">
                <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;">Type</label>
                <select name="type" required>
                    <option value="bug">üêõ Bug Report</option>
                    <option value="feature">‚ú® Feature Request</option>
                    <option value="feedback" selected>üìù General Feedback</option>
                </select>
                <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;">Your Name</label>
                <input type="text" name="name" required placeholder="Enter your name">
                <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;">Message</label>
                <textarea name="message" required placeholder="Describe your feedback..."></textarea>
                <button type="submit" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #4caf50, #388e3c); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">Send Feedback</button>
            </form>
        </div>
    </div>

    <!-- AI Widget -->
    <div id="aiWidget" style="position: fixed; bottom: 80px; left: 20px; z-index: 999;">
        <button id="aiToggle" onclick="toggleAI()" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%); border: none; color: white; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-size: 24px; display: flex; align-items: center; justify-content: center; position: relative;">
            ü©∫
            <span style="position: absolute; top: -2px; left: -2px; background: #8b5cf6; color: white; border-radius: 4px; padding: 2px 5px; font-size: 9px; font-weight: bold;">AI</span>
        </button>
        <div id="aiBox" style="display: none; flex-direction: column; position: absolute; bottom: 70px; left: 0; width: 380px; height: 500px; background: var(--bg-primary); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: 700;">ü©∫ AI Nursing Assistant</span>
                <button onclick="toggleAI()" style="background: none; border: none; color: white; cursor: pointer; font-size: 18px;">&times;</button>
            </div>
            <div style="background: #fef3c7; padding: 8px 12px; font-size: 11px; color: #92400e;">‚ö†Ô∏è <strong>Educational Only:</strong> Not medical advice. Always verify with clinical resources.</div>
            <div style="padding: 10px; display: flex; gap: 6px; flex-wrap: wrap; border-bottom: 1px solid var(--border);">
                <button onclick="aiQuickAction('drug')" style="padding: 5px 10px; border-radius: 12px; border: none; background: #0d9488; color: white; cursor: pointer; font-size: 11px;">üíä Drug Info</button>
                <button onclick="aiQuickAction('careplan')" style="padding: 5px 10px; border-radius: 12px; border: none; background: #0d9488; color: white; cursor: pointer; font-size: 11px;">üìã Care Plan</button>
                <button onclick="aiQuickAction('nclex')" style="padding: 5px 10px; border-radius: 12px; border: none; background: #0d9488; color: white; cursor: pointer; font-size: 11px;">üìù NCLEX Q</button>
                <button onclick="aiQuickAction('labs')" style="padding: 5px 10px; border-radius: 12px; border: none; background: #0d9488; color: white; cursor: pointer; font-size: 11px;">üî¨ Labs</button>
            </div>
            <div id="aiMessages" style="flex: 1; overflow-y: auto; padding: 15px; background: var(--bg-secondary);">
                <div style="background: var(--chat-msg-other-bg); padding: 10px 14px; border-radius: 16px; margin-bottom: 10px; font-size: 14px; color: var(--text-primary);">Hi! I'm your AI nursing assistant. Ask me about medications, care plans, NCLEX questions, or lab values. How can I help you today?</div>
            </div>
            <form onsubmit="sendAIMessage(event)" style="padding: 10px; border-top: 1px solid var(--border); display: flex; gap: 8px; background: var(--bg-primary);">
                <input type="text" id="aiInput" placeholder="Ask a nursing question..." style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 20px; font-size: 14px; background: var(--bg-input); color: var(--text-primary);">
                <button type="submit" style="background: linear-gradient(135deg, #0d9488, #14b8a6); color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer;">Ask</button>
            </form>
        </div>
    </div>

    <footer>
        BSN9B Nursing Resources
    </footer>

    <script>
        // Display current user
        const currentUsername = localStorage.getItem('bsn9b_user');
        if (currentUsername) {
            document.getElementById('userDisplay').textContent = 'Logged in as: ' + currentUsername;
        }

        // Logout function
        function logout() {
            localStorage.removeItem('bsn9b_auth');
            localStorage.removeItem('bsn9b_user');
            localStorage.removeItem('bsn9b_displayName');
            localStorage.removeItem('bsn9b_uid');
            window.location.href = '/';
        }

        // Theme functions
        function initTheme() {
            const saved = localStorage.getItem('bsn9b_theme') || 'light';
            document.documentElement.setAttribute('data-theme', saved);
            updateThemeIcon();
        }
        function toggleDarkMode() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('bsn9b_theme', newTheme);
            updateThemeIcon();
        }
        function updateThemeIcon() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const themeMenuIcon = document.getElementById('themeMenuIcon');
            const themeMenuText = document.getElementById('themeMenuText');
            if (themeMenuIcon) {
                themeMenuIcon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            }
            if (themeMenuText) {
                themeMenuText.textContent = isDark ? 'Light Mode' : 'Dark Mode';
            }
        }

        // More menu toggle
        function toggleMoreMenu() {
            const menu = document.getElementById('moreMenu');
            menu.classList.toggle('show');
        }

        // Close more menu when clicking outside
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('moreMenu');
            const moreBtn = e.target.closest('.toolbar-item');
            if (!menu.contains(e.target) && (!moreBtn || !moreBtn.onclick?.toString().includes('toggleMoreMenu'))) {
                menu.classList.remove('show');
            }
        });

        initTheme();

        // Lock functions
        function lockScreen() {
            document.getElementById('lockScreenOverlay').style.display = 'flex';
        }
        function unlockScreen() {
            document.getElementById('lockScreenOverlay').style.display = 'none';
        }

        // AI functions
        let aiOpen = false;
        let aiConversation = [];
        const AI_API_URL = 'https://script.google.com/macros/s/AKfycbwJZ_2LLB4omX9sGWy1HA_GZx71L_evx1UbKnnq0e4Hg4_-lHTN90iAcf0voB-lCbLd/exec';

        function toggleAI() {
            aiOpen = !aiOpen;
            document.getElementById('aiBox').style.display = aiOpen ? 'flex' : 'none';
            if (aiOpen) document.getElementById('aiInput').focus();
        }
        function aiQuickAction(type) {
            const prompts = {
                drug: 'Tell me about a common medication used in nursing (pick one and explain)',
                careplan: 'Help me create a nursing care plan for a patient with hypertension',
                nclex: 'Give me an NCLEX-style practice question with rationale',
                labs: 'Explain common lab values nurses should know'
            };
            document.getElementById('aiInput').value = prompts[type];
            document.getElementById('aiInput').focus();
        }
        function addAIMessage(message, isUser) {
            const container = document.getElementById('aiMessages');
            const div = document.createElement('div');
            div.style.cssText = 'margin-bottom: 12px; display: flex; flex-direction: column; align-items: ' + (isUser ? 'flex-end' : 'flex-start') + ';';
            div.innerHTML = '<div style="background: ' + (isUser ? 'linear-gradient(135deg, #0d9488 0%, #14b8a6 100%)' : 'var(--chat-msg-other-bg)') + '; color: ' + (isUser ? 'white' : 'var(--text-primary)') + '; padding: 10px 14px; border-radius: ' + (isUser ? '16px 16px 4px 16px' : '16px 16px 16px 4px') + '; max-width: 85%; word-wrap: break-word; font-size: 14px; white-space: pre-wrap;">' + message.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>';
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        async function sendAIMessage(event) {
            event.preventDefault();
            const input = document.getElementById('aiInput');
            const text = input.value.trim();
            if (!text) return;
            addAIMessage(text, true);
            input.value = '';
            aiConversation.push({ role: 'user', content: text });
            if (aiConversation.length > 20) aiConversation = aiConversation.slice(-20);
            const typingDiv = document.createElement('div');
            typingDiv.id = 'aiTyping';
            typingDiv.innerHTML = '<div style="background: var(--chat-msg-other-bg); color: var(--text-primary); padding: 10px 14px; border-radius: 16px; font-size: 14px;">Thinking...</div>';
            document.getElementById('aiMessages').appendChild(typingDiv);
            try {
                const response = await fetch(AI_API_URL + '?action=aiChat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ messages: aiConversation })
                });
                const data = await response.json();
                document.getElementById('aiTyping')?.remove();
                if (data.success && data.response) {
                    addAIMessage(data.response, false);
                    aiConversation.push({ role: 'assistant', content: data.response });
                } else {
                    addAIMessage('Sorry, I encountered an error. Please try again.', false);
                }
            } catch (error) {
                document.getElementById('aiTyping')?.remove();
                addAIMessage('Sorry, I couldn\'t connect. Please try again.', false);
            }
        }

        // Drug lookup state
        let drugSearchTimeout = null;

        // Smart Drug Search - combines spelling suggestions + approximate matching
        async function smartDrugSearch(query, dropdownId, onSelect) {
            const dropdown = document.getElementById(dropdownId);

            if (query.length < 2) {
                dropdown.classList.remove('show');
                return;
            }

            dropdown.innerHTML = '<div class="drug-autocomplete-loading">Searching...</div>';
            dropdown.classList.add('show');

            try {
                // Use multiple search strategies for better results
                const results = new Map(); // Use Map to deduplicate by rxcui

                // 1. Spelling suggestions (helps with typos like "metforman" -> "metformin")
                const spellResponse = await fetch(`https://rxnav.nlm.nih.gov/REST/spellingsuggestions.json?name=${encodeURIComponent(query)}`);
                const spellData = await spellResponse.json();

                if (spellData.suggestionGroup?.suggestionList?.suggestion) {
                    // Get RxCUI for each spelling suggestion
                    for (const suggestion of spellData.suggestionGroup.suggestionList.suggestion.slice(0, 5)) {
                        const rxcuiResponse = await fetch(`https://rxnav.nlm.nih.gov/REST/rxcui.json?name=${encodeURIComponent(suggestion)}`);
                        const rxcuiData = await rxcuiResponse.json();
                        if (rxcuiData.idGroup?.rxnormId?.[0]) {
                            results.set(rxcuiData.idGroup.rxnormId[0], {
                                rxcui: rxcuiData.idGroup.rxnormId[0],
                                name: suggestion,
                                type: 'exact'
                            });
                        }
                    }
                }

                // 2. Approximate term matching (fuzzy search)
                const approxResponse = await fetch(`https://rxnav.nlm.nih.gov/REST/approximateTerm.json?term=${encodeURIComponent(query)}&maxEntries=15`);
                const approxData = await approxResponse.json();

                if (approxData.approximateGroup?.candidate) {
                    approxData.approximateGroup.candidate.forEach(c => {
                        if (c.rxcui && c.name && !results.has(c.rxcui)) {
                            results.set(c.rxcui, {
                                rxcui: c.rxcui,
                                name: c.name,
                                type: c.rank > 50 ? 'close' : 'approx'
                            });
                        }
                    });
                }

                // 3. Direct drug search as fallback
                const drugResponse = await fetch(`https://rxnav.nlm.nih.gov/REST/drugs.json?name=${encodeURIComponent(query)}`);
                const drugData = await drugResponse.json();

                if (drugData.drugGroup?.conceptGroup) {
                    drugData.drugGroup.conceptGroup.forEach(group => {
                        if (group.conceptProperties) {
                            group.conceptProperties.slice(0, 10).forEach(prop => {
                                if (!results.has(prop.rxcui)) {
                                    results.set(prop.rxcui, {
                                        rxcui: prop.rxcui,
                                        name: prop.name,
                                        type: 'brand'
                                    });
                                }
                            });
                        }
                    });
                }

                // Build dropdown HTML
                const resultArray = Array.from(results.values()).slice(0, 12);

                if (resultArray.length === 0) {
                    dropdown.innerHTML = '<div class="drug-autocomplete-loading">No matches found. Try different spelling.</div>';
                } else {
                    let html = '';
                    if (query.length >= 2 && spellData.suggestionGroup?.suggestionList?.suggestion?.[0] !== query) {
                        const topSuggestion = spellData.suggestionGroup?.suggestionList?.suggestion?.[0];
                        if (topSuggestion && topSuggestion.toLowerCase() !== query.toLowerCase()) {
                            html += `<div class="drug-autocomplete-hint">Did you mean: <strong>${topSuggestion}</strong>?</div>`;
                        }
                    }
                    resultArray.forEach(drug => {
                        const escapedName = drug.name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        html += `<div class="drug-autocomplete-item" onclick="${onSelect}('${drug.rxcui}', '${escapedName}')">${drug.name}</div>`;
                    });
                    dropdown.innerHTML = html;
                }
            } catch (error) {
                console.error('Drug search error:', error);
                dropdown.innerHTML = '<div class="drug-autocomplete-loading">Search error. Try again.</div>';
            }
        }

        // Drug Information search input handler
        document.getElementById('drugSearch').addEventListener('input', function() {
            clearTimeout(drugSearchTimeout);
            const query = this.value.trim();

            if (query.length < 2) {
                document.getElementById('drugSearchDropdown').classList.remove('show');
                return;
            }

            drugSearchTimeout = setTimeout(() => {
                smartDrugSearch(query, 'drugSearchDropdown', 'selectDrugInfo');
            }, 300);
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.drug-search-wrapper')) {
                document.getElementById('drugSearchDropdown').classList.remove('show');
            }
        });

        // Select drug for information display
        async function selectDrugInfo(rxcui, name) {
            document.getElementById('drugSearchDropdown').classList.remove('show');
            document.getElementById('drugSearch').value = name;

            const infoDiv = document.getElementById('drugInfo');
            document.getElementById('drugInfoName').textContent = name;
            document.getElementById('drugInfoDetails').innerHTML = '<p>Loading details...</p>';
            infoDiv.style.display = 'block';

            // Set external links
            document.getElementById('drugLinkDailyMed').href = `https://dailymed.nlm.nih.gov/dailymed/search.cfm?query=${encodeURIComponent(name)}`;
            document.getElementById('drugLinkDrugs').href = `https://www.drugs.com/search.php?searchterm=${encodeURIComponent(name)}`;

            try {
                // Get drug class info
                const classResponse = await fetch(`https://rxnav.nlm.nih.gov/REST/rxclass/class/byRxcui.json?rxcui=${rxcui}`);
                const classData = await classResponse.json();

                let details = '';

                if (classData.rxclassDrugInfoList && classData.rxclassDrugInfoList.rxclassDrugInfo) {
                    const classes = classData.rxclassDrugInfoList.rxclassDrugInfo;
                    const uniqueClasses = [...new Set(classes.map(c => c.rxclassMinConceptItem.className))].slice(0, 5);
                    if (uniqueClasses.length > 0) {
                        details += `<p><strong>Drug Class:</strong> ${uniqueClasses.join(', ')}</p>`;
                    }
                }

                // Get related drugs (brand names)
                const relatedResponse = await fetch(`https://rxnav.nlm.nih.gov/REST/rxcui/${rxcui}/related.json?tty=BN`);
                const relatedData = await relatedResponse.json();

                if (relatedData.relatedGroup && relatedData.relatedGroup.conceptGroup) {
                    const brands = relatedData.relatedGroup.conceptGroup
                        .filter(g => g.conceptProperties)
                        .flatMap(g => g.conceptProperties.map(p => p.name))
                        .slice(0, 5);
                    if (brands.length > 0) {
                        details += `<p><strong>Brand Names:</strong> ${brands.join(', ')}</p>`;
                    }
                }

                details += `<p><strong>RxCUI:</strong> ${rxcui}</p>`;
                document.getElementById('drugInfoDetails').innerHTML = details || '<p>Basic info only. Click links below for full details.</p>';

            } catch (error) {
                document.getElementById('drugInfoDetails').innerHTML = '<p>Could not load details. Use links below.</p>';
            }
        }

        function calculateDripRate() {
            const volume = parseFloat(document.getElementById('ivVolume').value);
            const time = parseFloat(document.getElementById('ivTime').value);
            const dropFactor = parseFloat(document.getElementById('ivDropFactor').value);
            const result = document.getElementById('dripResult');

            if (!volume || !time || !dropFactor) {
                result.innerHTML = '<span style="color: #c00;">Please enter all values</span>';
                result.style.display = 'block';
                return;
            }

            if (time <= 0) {
                result.innerHTML = '<span style="color: #c00;">Time must be greater than 0</span>';
                result.style.display = 'block';
                return;
            }

            // IV Drip Rate Formula: gtt/min = (Volume mL √ó Drop Factor) √∑ (Time in min)
            const mlPerHour = volume / time;
            const gttsPerMin = (volume * dropFactor) / (time * 60);

            result.innerHTML = `
                <strong>Flow Rate:</strong> ${mlPerHour.toFixed(1)} mL/hr<br>
                <strong>Drip Rate:</strong> ${Math.round(gttsPerMin)} gtt/min<br>
                <span style="font-size: 11px; color: #666;">Formula: (${volume} mL √ó ${dropFactor} gtt/mL) √∑ (${time} hr √ó 60 min)</span>
            `;
            result.style.display = 'block';
        }

        function calculateDosage() {
            const desired = parseFloat(document.getElementById('desiredDose').value);
            const have = parseFloat(document.getElementById('haveOnHand').value);
            const qty = parseFloat(document.getElementById('quantity').value);
            const unit = document.getElementById('quantityUnit').value;
            const result = document.getElementById('dosageResult');

            if (!desired || !have || !qty) {
                result.innerHTML = '<span style="color: #c00;">Please enter all values</span>';
                result.style.display = 'block';
                return;
            }

            if (have <= 0) {
                result.innerHTML = '<span style="color: #c00;">"Have on Hand" must be greater than 0</span>';
                result.style.display = 'block';
                return;
            }

            // D/H √ó Q Formula
            const give = (desired / have) * qty;

            result.innerHTML = `
                <strong>Administer:</strong> ${give.toFixed(2)} ${unit}(s)<br>
                <span style="font-size: 11px; color: #666;">Formula: (${desired} mg √∑ ${have} mg) √ó ${qty} ${unit}</span>
            `;
            result.style.display = 'block';
        }

        function calculateWeightDose() {
            const mgPerKg = parseFloat(document.getElementById('mgPerKg').value);
            let weight = parseFloat(document.getElementById('patientWeight').value);
            const weightUnit = document.getElementById('weightUnit').value;
            const result = document.getElementById('weightDoseResult');

            if (!mgPerKg || !weight) {
                result.innerHTML = '<span style="color: #c00;">Please enter all values</span>';
                result.style.display = 'block';
                return;
            }

            // Convert lbs to kg if needed (1 lb = 0.453592 kg)
            let weightInKg = weight;
            if (weightUnit === 'lb') {
                weightInKg = weight * 0.453592;
            }

            const totalDose = mgPerKg * weightInKg;

            result.innerHTML = `
                <strong>Total Dose:</strong> ${totalDose.toFixed(1)} mg<br>
                ${weightUnit === 'lb' ? `<span style="font-size: 11px; color: #666;">Patient weight: ${weightInKg.toFixed(1)} kg (${weight} lb)</span><br>` : ''}
                <span style="font-size: 11px; color: #666;">Formula: ${mgPerKg} mg/kg √ó ${weightInKg.toFixed(1)} kg</span>
            `;
            result.style.display = 'block';
        }

        function toggleCollapse(element) {
            element.classList.toggle('collapsed');
            const content = element.nextElementSibling;
            content.classList.toggle('hidden');
        }

        // APGAR Calculator
        function calculateAPGAR() {
            const appearance = parseInt(document.getElementById('apgar-appearance').value) || 0;
            const pulse = parseInt(document.getElementById('apgar-pulse').value) || 0;
            const grimace = parseInt(document.getElementById('apgar-grimace').value) || 0;
            const activity = parseInt(document.getElementById('apgar-activity').value) || 0;
            const respiration = parseInt(document.getElementById('apgar-respiration').value) || 0;

            const score = appearance + pulse + grimace + activity + respiration;
            document.getElementById('apgar-score').textContent = score;

            let interpretation = '';
            if (score >= 7) {
                interpretation = '(Normal - reassuring)';
            } else if (score >= 4) {
                interpretation = '(Moderately abnormal - needs intervention)';
            } else {
                interpretation = '(Critically low - immediate resuscitation)';
            }
            document.getElementById('apgar-interpretation').textContent = interpretation;
        }
    </script>

    <!-- Chat Widget -->
    <div id="chatWidget" style="position: fixed; bottom: 80px; right: 20px; z-index: 999; font-family: 'Segoe UI', sans-serif;">
        <button id="chatToggle" onclick="toggleChat()" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #1f4e79 0%, #2d5a87 100%); color: white; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-size: 24px; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; position: relative;">üí¨</button>
        <span id="chatBadge" style="display: none; position: absolute; top: -5px; right: -5px; background: #e94560; color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; font-weight: bold; align-items: center; justify-content: center;">0</span>
        <span id="dmBadge" style="display: none; position: absolute; top: -5px; left: -5px; background: #8b5cf6; color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; font-weight: bold; align-items: center; justify-content: center;">0</span>

        <div id="chatBox" style="display: none; flex-direction: column; position: absolute; bottom: 70px; right: 0; width: 380px; height: 500px; background: var(--bg-primary); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #1f4e79 0%, #2d5a87 100%); color: white; padding: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span id="chatTitle" style="font-weight: 700; font-size: 16px;">BSN9B Chat</span>
                        <div id="onlineCount" onclick="toggleUserList()" style="font-size: 11px; opacity: 0.8; cursor: pointer;">Connecting...</div>
                    </div>
                    <button onclick="toggleChat()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 16px;">&times;</button>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 10px;">
                    <button id="tabGroupChat" onclick="switchChatMode('group')" style="flex: 1; padding: 8px; border: none; border-radius: 8px; background: rgba(255,255,255,0.3); color: white; font-size: 12px; font-weight: 600; cursor: pointer;">üë• Group</button>
                    <button id="tabDM" onclick="switchChatMode('dm')" style="flex: 1; padding: 8px; border: none; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; font-size: 12px; font-weight: 600; cursor: pointer;">‚úâÔ∏è Direct <span id="dmTabBadge" style="display: none; background: #8b5cf6; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 4px;">0</span></button>
                </div>
            </div>

            <div id="userList" style="display: none; background: #1a3d5c; color: white; padding: 10px 15px; font-size: 12px; max-height: 100px; overflow-y: auto;">
                <div style="opacity: 0.7; margin-bottom: 5px;">Online now:</div>
                <div id="userListNames"></div>
            </div>

            <div id="groupChatView" style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 15px; background: var(--bg-secondary);"></div>
                <div style="padding: 12px; border-top: 1px solid var(--border); background: var(--bg-primary);">
                    <form onsubmit="sendMessage(event)" style="display: flex; gap: 8px;">
                        <input type="text" id="chatInput" placeholder="Type a message..." style="flex: 1; padding: 10px 14px; border: 1px solid var(--border); border-radius: 20px; font-size: 14px; background: var(--bg-input); color: var(--text-primary);" maxlength="500">
                        <button type="submit" style="background: linear-gradient(135deg, #1f4e79 0%, #2d5a87 100%); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 16px;">‚û§</button>
                    </form>
                </div>
            </div>

            <div id="dmView" style="flex: 1; display: none; flex-direction: column; overflow: hidden;">
                <div id="dmConversationList" style="flex: 1; overflow-y: auto; padding: 15px; background: var(--bg-secondary);">
                    <div style="margin-bottom: 15px;">
                        <button onclick="showNewDMSelector()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px;">‚úèÔ∏è New Message</button>
                    </div>
                    <div id="dmConversations" style="color: var(--text-secondary); font-size: 12px; text-align: center;">Loading conversations...</div>
                </div>

                <div id="dmMessageView" style="display: none; flex: 1; flex-direction: column; overflow: hidden;">
                    <div id="dmHeader" style="padding: 10px 15px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px;">
                        <button onclick="closeDMConversation()" style="background: none; border: none; font-size: 18px; cursor: pointer; padding: 4px; color: var(--text-primary);">‚Üê</button>
                        <span id="dmPartnerName" style="font-weight: 600; color: var(--accent);">Partner Name</span>
                        <span id="dmPartnerStatus" style="font-size: 10px; padding: 2px 8px; border-radius: 10px; background: var(--border); color: var(--text-secondary);">offline</span>
                    </div>
                    <div id="dmMessages" style="flex: 1; overflow-y: auto; padding: 15px; background: var(--bg-secondary);"></div>
                    <div style="padding: 12px; border-top: 1px solid var(--border); background: var(--bg-primary);">
                        <form onsubmit="sendDM(event)" style="display: flex; gap: 8px;">
                            <input type="text" id="dmInput" placeholder="Type a message..." style="flex: 1; padding: 10px 14px; border: 1px solid var(--border); border-radius: 20px; font-size: 14px; background: var(--bg-input); color: var(--text-primary);" maxlength="500">
                            <button type="submit" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 16px;">‚û§</button>
                        </form>
                    </div>
                </div>

                <div id="newDMSelector" style="display: none; flex: 1; flex-direction: column; overflow: hidden;">
                    <div style="padding: 10px 15px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px;">
                        <button onclick="hideNewDMSelector()" style="background: none; border: none; font-size: 18px; cursor: pointer; padding: 4px; color: var(--text-primary);">‚Üê</button>
                        <span style="font-weight: 600; color: var(--accent);">New Message</span>
                    </div>
                    <div style="padding: 15px;">
                        <input type="text" id="dmUserSearch" placeholder="Search users..." oninput="filterDMUsers()" style="width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 20px; font-size: 14px; background: var(--bg-input); color: var(--text-primary); margin-bottom: 15px;">
                    </div>
                    <div id="dmUserList" style="flex: 1; overflow-y: auto; padding: 0 15px 15px 15px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAmr2W8mekSPJ2pXM3gz1FvarfSBddpfLM",
            authDomain: "bendbsn-17377.firebaseapp.com",
            databaseURL: "https://bendbsn-17377-default-rtdb.firebaseio.com",
            projectId: "bendbsn-17377",
            storageBucket: "bendbsn-17377.firebasestorage.app",
            messagingSenderId: "762882187702",
            appId: "1:762882187702:web:81c97c9eae005666796117"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>

    <!-- Shared Chat Module -->
    <script src="/js/chat.js"></script>
</body>
</html>
