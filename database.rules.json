{
  "rules": {
    ".read": false,
    ".write": false,

    "chat": {
      "channels": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')"
      },
      "messages": {
        ".read": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
        "$channelId": {
          ".read": "auth != null",
          ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
          "$messageId": {
            ".write": "auth != null && (!data.exists() || data.child('username').val() === auth.token.email || root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
            ".validate": "!newData.exists() || (newData.hasChildren(['user', 'username', 'text', 'timestamp']) && newData.child('username').val() === auth.token.email)",
            "reactions": {
              "$emoji": {
                "$uid": {
                  ".write": "auth != null && auth.uid === $uid",
                  ".validate": "newData.isBoolean() || !newData.exists()"
                }
              }
            }
          }
        }
      },
      "presence": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
        "$uid": {
          ".write": "auth != null && (auth.uid === $uid || root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')"
        }
      },
      "typing": {
        "$channelId": {
          ".read": "auth != null",
          "$uid": {
            ".write": "auth != null && auth.uid === $uid"
          }
        }
      },
      "channelMembers": {
        ".read": "auth != null",
        ".write": "auth != null"
      },
      "threads": {
        "$channelId": {
          "$msgKey": {
            ".read": "auth != null",
            "replies": {
              "$replyKey": {
                ".write": "auth != null && (!data.exists() || data.child('username').val() === auth.token.email)"
              }
            }
          }
        }
      }
    },

    "directMessages": {
      "$convId": {
        ".read": "auth != null && (data.child('participants').child('user1_uid').val() === auth.uid || data.child('participants').child('user2_uid').val() === auth.uid)",
        ".write": "auth != null && (!data.exists() ? ((newData.child('participants').child('user1_uid').val() === auth.uid || newData.child('participants').child('user2_uid').val() === auth.uid) && newData.child('participants').child('user1_uid').val() != null && newData.child('participants').child('user2_uid').val() != null) : ((data.child('participants').child('user1_uid').val() === auth.uid || data.child('participants').child('user2_uid').val() === auth.uid) && newData.child('participants').child('user1_uid').val() === data.child('participants').child('user1_uid').val() && newData.child('participants').child('user2_uid').val() === data.child('participants').child('user2_uid').val()))",
        "messages": {
          "$messageId": {
            "reactions": {
              "$emoji": {
                "$uid": {
                  ".validate": "auth != null && auth.uid === $uid && (newData.isBoolean() || !newData.exists())"
                }
              }
            }
          }
        }
      }
    },

    "community": {
      "posts": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
        "$postId": {
          ".write": "auth != null && (!data.exists() || data.child('authorEmail').val() === auth.token.email || root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
          ".validate": "!newData.exists() || newData.hasChild('author')",
          "replies": {
            "$replyId": {
              ".write": "auth != null && (!data.exists() || data.child('authorEmail').val() === auth.token.email || root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')"
            }
          },
          "likes": {
            "$uid": {
              ".write": "auth != null && auth.uid === $uid"
            }
          },
          "likedBy": {
            "$uid": {
              ".write": "auth != null && auth.uid === $uid"
            }
          }
        }
      }
    },

    "userDocuments": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },

    "userProfiles": {
      ".read": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
      ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
      "$uid": {
        ".read": "auth != null && (auth.uid === $uid || root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
        ".write": "auth != null && (auth.uid === $uid || root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
        "isAdmin": {
          ".validate": "(root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || auth.token.email === 'christiankholden@gmail.com') && (newData.isBoolean() || !newData.exists())"
        }
      }
    },

    "announcements": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')"
    },

    "banned": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')"
    },

    "globalPhrases": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')"
    },

    "loginHistory": {
      ".read": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
      ".write": "auth != null"
    },

    "userExportHistory": {
      ".read": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
      ".write": "auth != null"
    },

    "notificationLog": {
      ".read": "auth != null && (root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true || root.child('userProfiles').child(auth.uid).child('role_id').val() === 'instructor')",
      ".write": "auth != null"
    },

    "userLastSeen": {
      ".read": "auth != null",
      "$uid": {
        ".write": "auth != null && auth.uid === $uid",
        ".validate": "newData.isNumber()"
      }
    },

    "appConfig": {
      ".write": "auth != null && root.child('userProfiles').child(auth.uid).child('isAdmin').val() === true",
      "roles": {
        ".read": true
      },
      "$other": {
        ".read": "auth != null"
      }
    },

    "groupChats": {
      ".read": "auth != null",
      ".write": "auth != null"
    },

    "userFCMTokens": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    }
  }
}
